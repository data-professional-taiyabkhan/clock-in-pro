[phases.setup]
nixPkgs = [
  "nodejs_20",
  "bash",
  "coreutils"
]
aptPkgs = [
  "python3",
  "python3-pip",
  "python3-venv",
  "build-essential",
  "g++",
  "gcc",
  "make",
  "cmake",
  "pkg-config",
  "libstdc++6",
  "libgl1",
  "libglib2.0-0",
  "libsm6",
  "libxext6",
  "libxrender1"
]

# Disable Caddy phase - we use Express to serve the app
[phases.caddy]
cmds = []

[phases.install]
cmds = [
  "npm install --legacy-peer-deps"
]

[phases.build]
cmds = [
  "/usr/bin/python3 -m venv --copies /app/.venv",
  "/app/.venv/bin/pip install --no-cache-dir --upgrade pip",
  "/app/.venv/bin/pip install --no-cache-dir -r python-requirements.txt",
  "npm run build"
]

[start]
cmd = "npm start"

[variables]
PYTHON_KEYRING_BACKEND = "keyring.backends.null.Keyring"
PYTHONUNBUFFERED = "1"
PATH = "/app/.venv/bin:$PATH"
